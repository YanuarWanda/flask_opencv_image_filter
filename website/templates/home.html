{% extends "base.html" %}

{% block title %} Home {% endblock %}

{% block content %}
<main>
    <form id="form" method="post" class="original-container" enctype="multipart/form-data">
        <h1>Original Image</h1>
        <img id="original" src="https://avataaars.io/?avatarStyle=Circle&topType=LongHairStraight&accessoriesType=Blank&hairColor=BrownDark&facialHairType=Blank&clotheType=BlazerShirt&eyeType=Default&eyebrowType=Default&mouthType=Default&skinColor=Ligh" />
        <input id="originalInput" type="file" name="image"/>
        <select id="filter" name="filter">
            <option value="1" selected>Filter 1</option>
            <option value="2">Filter 2</option>
            <option value="3">Filter 3</option>
            <option value="4">Filter 4</option>
        </select>
    </form>

    <section class="result-container">
        <h1>Result Image</h1>
        <img id="result" src="https://avataaars.io/?avatarStyle=Circle&topType=LongHairStraight&accessoriesType=Blank&hairColor=BrownDark&facialHairType=Blank&clotheType=BlazerShirt&eyeType=Default&eyebrowType=Default&mouthType=Default&skinColor=Ligh" />
    </section>
</main>
{% endblock %}

{% block script %}
<script>
    const originalImageEl = document.querySelector("#original");
    const originalInputEl = document.querySelector("#originalInput");
    const resultImageEl = document.querySelector("#result");
    const filterEl = document.querySelector("#filter");

    const sendData = () => {
        const formData = new FormData();
        formData.append("image", originalInputEl.files[0]);
        formData.append("filter", filterEl.value);

        fetch("/", {
            method: "POST",
            body: formData
        }).then(res => res.blob()).then(data => {
            console.log(data, typeof data);
            resultImageEl.setAttribute("src", URL.createObjectURL(data));
        });
    }

    originalInputEl.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            originalImageEl.setAttribute("src", URL.createObjectURL(e.target.files[0]));
            sendData();
        }
    });
</script>
{% endblock %}

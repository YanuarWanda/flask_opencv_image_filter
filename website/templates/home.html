{% extends "base.html" %}

{% block title %} Home {% endblock %}

{% block content %}
<main>
    <form id="form" method="post" class="original-container" enctype="multipart/form-data">
        <h1>Original Image</h1>
        <img id="original" src="https://avataaars.io/?avatarStyle=Circle&topType=LongHairStraight&accessoriesType=Blank&hairColor=BrownDark&facialHairType=Blank&clotheType=BlazerShirt&eyeType=Default&eyebrowType=Default&mouthType=Default&skinColor=Ligh" />
        <input id="originalInput" type="file" name="image"/>
        <select id="filter" name="filter">
            <option value="1" selected>Grayscale</option>
            <option value="2">Bright</option>
            <option value="3">Dark</option>
            <option value="4">Filter 4</option>
        </select>
    </form>

    <div class="result-container">
        <h1>Result Image</h1>
        <img id="result" src="https://avataaars.io/?avatarStyle=Circle&topType=LongHairStraight&accessoriesType=Blank&hairColor=BrownDark&facialHairType=Blank&clotheType=BlazerShirt&eyeType=Default&eyebrowType=Default&mouthType=Default&skinColor=Ligh" />
    </div>
</main>
{% endblock %}

{% block script %}
<script>
    const originalImageEl = document.querySelector("#original");
    const originalInputEl = document.querySelector("#originalInput");
    const resultImageEl = document.querySelector("#result");
    const filterEl = document.querySelector("#filter");
    const selectEl = document.querySelector("#selectInput");

    const sendData = async () => {
        const formData = new FormData();
        formData.append("image", originalInputEl.files[0]);
        formData.append("filter", filterEl.value);

        setLoading(true);

        const res = await fetch("/", {
            method: "POST",
            body: formData
        });
        if (res.status != 200) return;
        const data = await res.blob();
        resultImageEl.setAttribute("src", URL.createObjectURL(data));

        setLoading(false);
    }

    originalInputEl.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            originalImageEl.setAttribute("src", URL.createObjectURL(e.target.files[0]));
            sendData();
        }
    });

    filterEl.addEventListener('change', (e) => {
        console.log(e.target.value)
        sendData()
    });
</script>
{% endblock %}
